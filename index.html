<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>تطبيق صلاة القضاء - قضاء ما فات من الصلوات</title>
    <style>
        /* إضافة تنسيقات القائمة الجانبية */
        .sidebar {
            position: fixed;
            top: 0;
            right: -320px;
            width: 300px;
            height: 100%;
            background-color: white;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            z-index: 2000;
            transition: right 0.3s ease;
            overflow-y: auto;
            padding: 20px;
        }
        
        .sidebar.open {
            right: 0;
        }
        
        .sidebar-overlay {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1999;
            display: none;
        }
        
        .sidebar-overlay.show {
            display: block;
        }
        
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #1a5f23;
        }
        
        .sidebar-header h2 {
            color: #1a5f23;
            margin: 0;
            font-size: 1.5rem;
        }
        
        body.dark-mode .sidebar-header h2 {
            color: #4CAF50;
        }
        
        .close-sidebar {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #2c3e50;
            cursor: pointer;
        }
        
        body.dark-mode .close-sidebar {
            color: #f5f5f5;
        }
        
        .sidebar-section {
            margin-bottom: 25px;
        }
        
        .sidebar-section h3 {
            color: #1a5f23;
            margin-bottom: 15px;
            font-size: 1.3rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }
        
        body.dark-mode .sidebar-section h3 {
            color: #4CAF50;
            border-bottom-color: #555;
        }
        
        .sidebar-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 10px;
            background-color: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 10px;
            color: #2c3e50;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: right;
        }
        
        .sidebar-btn:hover {
            background-color: #1a5f23;
            color: white;
            border-color: #1a5f23;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        body.dark-mode .sidebar-btn {
            background-color: #3d3d3d;
            color: #f5f5f5;
            border-color: #555;
        }
        
        body.dark-mode .sidebar-btn:hover {
            background-color: #4CAF50;
            color: white;
            border-color: #4CAF50;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
        }
        
        .sidebar-btn.danger {
            background-color: #fff5f5;
            border-color: #f8d7da;
            color: #721c24;
        }
        
        .sidebar-btn.danger:hover {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .sidebar-btn i {
            font-size: 1.2rem;
        }
        
        /* تحديث تنسيق الهيدر */
        .fixed-header {
            position: fixed;
            top: 0;
            right: 0;
            left: 0;
            background-color: #1a5f23;
            color: white;
            padding: 15px 20px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        body.dark-mode .fixed-header {
            background-color: #2d2d2d;
            border-bottom: 1px solid #444;
        }
        
        .menu-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .menu-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .fixed-header h1 {
            font-family: 'Scheherazade New', serif;
            font-size: 1.5rem;
            margin: 0;
            text-align: center;
            flex: 1;
        }
        
        /* زر إعادة الحساب في الهيدر */
        .back-to-calc-btn {
            display: none;
        }
        
        .back-to-calc-btn.show {
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .back-to-calc-btn.show:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        /* تحديث تنسيق الأقسام */
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
            flex-wrap: wrap;
            display: none;
        }
        
        /* إخفاء قسم الإحصائيات والصلوات والسجلات في العرض الأولي */
        .stats-section, .prayers-section, .records-section {
            display: none;
        }
        
        .target-section {
            display: none;
        }
        
        /* تنسيق عرض الصلوات فقط بعد الحساب */
        .main-sections {
            display: none;
        }
        
        .main-sections.show {
            display: block;
        }
        
        /* الصفحات المنفصلة */
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .page.active {
            display: block;
        }
        
        .page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #d4af37;
        }
        
        .page-header h2 {
            color: #1a5f23;
            font-size: 2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        body.dark-mode .page-header h2 {
            color: #4CAF50;
        }
        
        .back-btn {
            background-color: #f8f9fa;
            border: 2px solid #ddd;
            color: #2c3e50;
            border-radius: 10px;
            padding: 10px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background-color: #1a5f23;
            color: white;
            border-color: #1a5f23;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        body.dark-mode .back-btn {
            background-color: #3d3d3d;
            color: #f5f5f5;
            border-color: #555;
        }
        
        body.dark-mode .back-btn:hover {
            background-color: #4CAF50;
            color: white;
            border-color: #4CAF50;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary-color: #1a5f23;
            --secondary-color: #d4af37;
            --light-color: #f8f9fa;
            --dark-color: #2c3e50;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --border-radius: 15px;
            --transition: all 0.3s ease;
        }
        body {
            font-family: 'Amiri', serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            background-image: linear-gradient(to bottom, rgba(245, 245, 245, 0.9), rgba(245, 245, 245, 0.9)), url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0zNiAxOGMtMy4zMTMgMC02IDIuNjg3LTYgNnMyLjY4NyA2IDYgNiA2LTIuNjg3IDYtNi0yLjY4Ny02LTYtNnoiIGZpbGw9IiMxYTVmMjMiIGZpbGwtb3BhY2l0eT0iMC4wNSIvPjwvZz48L3N2Zz4=');
            padding-top: 70px;
            -ms-touch-action: pan-y pinch-zoom;
            touch-action: pan-y;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        /* مود داكن */
        body.dark-mode {
            background-color: #1a1a1a;
            color: #e0e0e0;
            background-image: linear-gradient(to bottom, rgba(26, 26, 26, 0.9), rgba(26, 26, 26, 0.9)), url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0zNiAxOGMtMy4zMTMyIDAtNiAyLjY4NjgtNiA2czIuNjg2OCA2IDYgNiA2LTIuNjg2OCA2LTYtMi42ODY4LTYtNi02eiIgZmlsbD0iIzFhNWYyMyIgZmlsbC1vcGFjaXR5PSIwLjEiLz48L2c+PC9zdmc+');
        }
        
        body.dark-mode .calculator-section,
        body.dark-mode .target-section,
        body.dark-mode .stats-section,
        body.dark-mode .prayers-section,
        body.dark-mode .records-section,
        body.dark-mode .sidebar,
        body.dark-mode .page {
            background-color: #2d2d2d;
            color: #e0e0e0;
        }
        
        body.dark-mode .calculator-section h2,
        body.dark-mode .target-section h2,
        body.dark-mode .stats-section h2,
        body.dark-mode .prayers-section h2,
        body.dark-mode .records-section h2,
        body.dark-mode .page-header h2 {
            color: #4CAF50;
        }
        
        body.dark-mode .option-card,
        body.dark-mode .prayer-option,
        body.dark-mode .btn,
        body.dark-mode .control-btn,
        body.dark-mode .filter-btn,
        body.dark-mode .calc-btn,
        body.dark-mode .target-btn,
        body.dark-mode .apply-results-btn {
            background-color: #3d3d3d;
            color: #e0e0e0;
            border-color: #555;
        }
        
        body.dark-mode .option-card:hover,
        body.dark-mode .prayer-option:hover,
        body.dark-mode .btn:hover,
        body.dark-mode .control-btn:hover,
        body.dark-mode .filter-btn:hover,
        body.dark-mode .calc-btn:hover,
        body.dark-mode .target-btn:hover,
        body.dark-mode .apply-results-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        body.dark-mode .input-control,
        body.dark-mode .filter-select,
        body.dark-mode .filter-date,
        body.dark-mode .target-input {
            background-color: #3d3d3d;
            color: #e0e0e0;
            border-color: #555;
        }
        
        body.dark-mode .input-control:focus,
        body.dark-mode .filter-select:focus,
        body.dark-mode .filter-date:focus,
        body.dark-mode .target-input:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
        }
        
        body.dark-mode .step-header,
        body.dark-mode .step-description,
        body.dark-mode .option-title,
        body.dark-mode .prayer-name {
            color: #e0e0e0;
        }
        
        body.dark-mode .option-desc,
        body.dark-mode .prayer-target,
        body.dark-mode .prayer-date {
            color: #aaa;
        }
        
        body.dark-mode .results-summary,
        body.dark-mode .result-item,
        body.dark-mode .stats-card,
        body.dark-mode .prayer-card,
        body.dark-mode .filter-section {
            background-color: #3d3d3d;
            color: #e0e0e0;
            border-color: #444;
        }
        
        body.dark-mode .progress-container,
        body.dark-mode .prayer-progress-container {
            background-color: #444;
        }
        
        body.dark-mode footer {
            background-color: #2c3e50;
            color: #e0e0e0;
        }
        
        body.dark-mode .alert {
            background-color: #2d2d2d;
            color: #e0e0e0;
        }
        
        /* تنسيق زر التبديل بين الوضعين */
        .theme-switch-wrapper {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 15px 0;
            padding: 12px 15px;
            background-color: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .theme-switch-wrapper:hover {
            background-color: #e9ecef;
        }
        
        body.dark-mode .theme-switch-wrapper {
            background-color: #3d3d3d;
            border-color: #555;
        }
        
        body.dark-mode .theme-switch-wrapper:hover {
            background-color: #4d4d4d;
        }
        
        .theme-switch {
            display: inline-block;
            height: 34px;
            position: relative;
            width: 60px;
            flex-shrink: 0;
        }
        
        .theme-switch input {
            display: none;
        }
        
        .slider {
            background-color: #ccc;
            bottom: 0;
            cursor: pointer;
            left: 0;
            position: absolute;
            right: 0;
            top: 0;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            background-color: white;
            bottom: 4px;
            content: "";
            height: 26px;
            left: 4px;
            position: absolute;
            transition: .4s;
            width: 26px;
            border-radius: 50%;
        }
        
        body.dark-mode .slider {
            background-color: #4CAF50;
        }
        
        input:checked + .slider {
            background-color: #4CAF50;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .slider-icons {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 8px;
            pointer-events: none;
        }
        
        .slider-icons i {
            color: #666;
            font-size: 16px;
            transition: color 0.3s ease;
        }
        
        body.dark-mode .slider-icons i.sun {
            color: #ccc;
        }
        
        body:not(.dark-mode) .slider-icons i.moon {
            color: #ccc;
        }
        
        .theme-label {
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            width: 100%;
        }
        
        .theme-text {
            font-size: 1.1rem;
            color: #2c3e50;
            flex-grow: 1;
        }
        
        body.dark-mode .theme-text {
            color: #e0e0e0;
        }
        
        .theme-icon {
            color: #d4af37;
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        header {
            text-align: center; 
            padding: 30px 20px; 
            background-color: #1a5f23;
            color: white; 
            border-radius: 15px; 
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
            position: relative; 
            overflow: hidden;
            margin-top: 10px;
            transition: background-color 0.3s ease;
        }
        
        body.dark-mode header {
            background-color: #2d2d2d;
        }
        
        header::before {
            content: "✓"; 
            font-family: Arial, sans-serif; 
            font-weight: 900;
            position: absolute; 
            font-size: 150px; 
            opacity: 0.1; 
            right: 20px; 
            top: 10px;
        }
        
        header h1 { 
            font-family: 'Scheherazade New', serif; 
            font-size: 2.8rem; 
            margin-bottom: 10px; 
            position: relative; 
            z-index: 1; 
        }
        
        header p { 
            font-size: 1.3rem; 
            max-width: 800px; 
            margin: 0 auto; 
            position: relative; 
            z-index: 1; 
            opacity: 0.9; 
        }
        
        .calculator-section { 
            background-color: white; 
            border-radius: 15px; 
            padding: 25px; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
            margin-bottom: 30px; 
            transition: background-color 0.3s ease;
        }
        
        .calculator-section h2 { 
            color: #1a5f23; 
            margin-bottom: 20px; 
            font-size: 2rem; 
            text-align: center; 
            border-bottom: 2px solid #d4af37; 
            padding-bottom: 10px; 
        }
        
        .calculator-step { display: none; }
        .calculator-step.active { display: block; animation: fadeIn 0.5s ease; }
        
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        .step-header { font-size: 1.5rem; color: #2c3e50; margin-bottom: 20px; text-align: center; }
        .step-description { font-size: 1.2rem; color: #666; margin-bottom: 25px; text-align: center; }
        .options-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .option-card { padding: 20px; border: 2px solid #ddd; border-radius: 10px; cursor: pointer; transition: all 0.3s ease; text-align: center; }
        .option-card:hover { border-color: #1a5f23; background-color: rgba(26, 95, 35, 0.05); transform: translateY(-3px); }
        .option-card.selected { border-color: #1a5f23; background-color: rgba(26, 95, 35, 0.1); }
        
        body.dark-mode .option-card {
            border-color: #555;
        }
        
        body.dark-mode .option-card:hover {
            border-color: #4CAF50;
            background-color: rgba(76, 175, 80, 0.1);
        }
        
        body.dark-mode .option-card.selected {
            border-color: #4CAF50;
            background-color: rgba(76, 175, 80, 0.2);
        }
        
        .option-icon { font-size: 2.5rem; color: #d4af37; margin-bottom: 10px; }
        .option-title { font-size: 1.3rem; color: #2c3e50; margin-bottom: 5px; }
        .option-desc { font-size: 1rem; color: #666; }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; font-size: 1.2rem; margin-bottom: 10px; color: #2c3e50; font-weight: bold; }
        .input-control { width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 1.2rem; font-family: 'Amiri', serif; transition: all 0.3s ease; }
        .input-control:focus { outline: none; border-color: #1a5f23; box-shadow: 0 0 0 3px rgba(26, 95, 35, 0.2); }
        .date-range { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .prayer-selection { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .prayer-option { padding: 15px; border: 2px solid #ddd; border-radius: 10px; cursor: pointer; transition: all 0.3s ease; text-align: center; }
        .prayer-option:hover { border-color: #1a5f23; background-color: rgba(26, 95, 35, 0.05); }
        .prayer-option.selected { border-color: #1a5f23; background-color: rgba(26, 95, 35, 0.1); }
        .prayer-option.all-selected { border-color: #1a5f23; background-color: rgba(26, 95, 35, 0.15); }
        
        body.dark-mode .prayer-option {
            border-color: #555;
        }
        
        body.dark-mode .prayer-option:hover {
            border-color: #4CAF50;
            background-color: rgba(76, 175, 80, 0.1);
        }
        
        body.dark-mode .prayer-option.selected {
            border-color: #4CAF50;
            background-color: rgba(76, 175, 80, 0.2);
        }
        
        body.dark-mode .prayer-option.all-selected {
            border-color: #4CAF50;
            background-color: rgba(76, 175, 80, 0.25);
        }
        
        .prayer-name { font-size: 1.3rem; color: #2c3e50; }
        .calculator-buttons { display: flex; justify-content: space-between; margin-top: 30px; }
        .calc-btn { background-color: #d4af37; color: #2c3e50; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.2rem; cursor: pointer; transition: all 0.3s ease; font-family: 'Amiri', serif; display: flex; align-items: center; gap: 10px; }
        .calc-btn.next { background-color: #1a5f23; color: white; }
        .calc-btn.next:hover { background-color: #13421b; }
        .calc-btn:disabled { background-color: #95a5a6; cursor: not-allowed; transform: none; }
        .results-section { background-color: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); margin-bottom: 30px; display: none; }
        .results-section h2 { color: #1a5f23; margin-bottom: 20px; font-size: 2rem; text-align: center; border-bottom: 2px solid #d4af37; padding-bottom: 10px; }
        .results-summary { background-color: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 25px; text-align: center; }
        .total-prayers-needed { font-size: 3rem; font-weight: bold; color: #1a5f23; margin: 10px 0; }
        .result-details { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .result-item { background-color: #f8f9fa; border-radius: 10px; padding: 15px; text-align: center; }
        .result-prayer { font-size: 1.3rem; color: #1a5f23; margin-bottom: 10px; }
        .result-count { font-size: 2rem; font-weight: bold; color: #2c3e50; }
        .apply-results-btn { background-color: #1a5f23; color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.3rem; cursor: pointer; transition: all 0.3s ease; font-family: 'Amiri', serif; display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%; margin-top: 20px; }
        .apply-results-btn:hover { background-color: #13421b; transform: scale(1.02); }
        
        .target-section { 
            background-color: white; 
            border-radius: 15px; 
            padding: 25px; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
            margin-bottom: 30px; 
            overflow: hidden;
        }
        
        .target-section h2 { 
            color: #1a5f23; 
            margin-bottom: 20px; 
            font-size: 2rem; 
            text-align: center; 
            border-bottom: 2px solid #d4af37; 
            padding-bottom: 10px; 
            word-break: break-word;
        }
        
        .target-form { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; 
        }
        
        .target-input-group { 
            display: flex; 
            flex-direction: column; 
            max-width: 100%;
        }
        
        .target-input-group label { 
            font-size: 1.2rem; 
            margin-bottom: 8px; 
            color: #2c3e50; 
            font-weight: bold; 
            word-break: break-word;
            text-align: center;
        }
        
        body.dark-mode .target-input-group label {
            color: #e0e0e0;
        }
        
        .target-input { 
            padding: 15px; 
            border: 2px solid #ddd; 
            border-radius: 10px; 
            font-size: 1.3rem; 
            text-align: center; 
            font-family: 'Amiri', serif; 
            transition: all 0.3s ease; 
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
        }
        
        .target-input:focus { outline: none; border-color: #1a5f23; box-shadow: 0 0 0 3px rgba(26, 95, 35, 0.2); }
        
        .target-btn { 
            grid-column: 1 / -1; 
            background-color: #d4af37; 
            color: #2c3e50; 
            border: none; 
            padding: 15px 30px; 
            border-radius: 10px; 
            font-size: 1.3rem; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            font-family: 'Amiri', serif; 
            font-weight: bold; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 10px; 
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            margin: 0 auto;
        }
        
        .target-btn:hover { background-color: #c19b2e; transform: scale(1.02); }
        
        .stats-section { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        
        .stats-card { 
            background-color: white; 
            border-radius: 15px; 
            padding: 25px; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
            text-align: center; 
            border-top: 5px solid #d4af37; 
        }
        
        .stats-card h2 { color: #1a5f23; margin-bottom: 15px; font-size: 1.8rem; }
        .total-prayers { font-size: 3.5rem; font-weight: bold; color: #1a5f23; margin: 15px 0; }
        .remaining-prayers { font-size: 3.5rem; font-weight: bold; color: #e74c3c; margin: 15px 0; }
        .progress-container { background-color: #ecf0f1; border-radius: 10px; height: 20px; margin: 20px 0; overflow: hidden; }
        .progress-bar { height: 100%; background-color: #1a5f23; border-radius: 10px; transition: all 0.3s ease; }
        
        .prayers-section { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 25px; 
            margin-bottom: 40px; 
        }
        
        .prayer-card { 
            background-color: white; 
            border-radius: 15px; 
            padding: 25px; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
            text-align: center; 
            transition: all 0.3s ease; 
            position: relative; 
            overflow: hidden; 
        }
        
        .prayer-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1); }
        .prayer-name { font-size: 2.2rem; color: #1a5f23; margin-bottom: 15px; font-family: 'Scheherazade New', serif; }
        
        body.dark-mode .prayer-name {
            color: #4CAF50;
        }
        
        .prayer-icon { font-size: 3rem; color: #d4af37; margin-bottom: 20px; }
        .prayer-count { font-size: 2rem; font-weight: bold; margin: 10px 0; color: #2c3e50; }
        
        body.dark-mode .prayer-count {
            color: #ffffff;
        }
        
        .prayer-target { font-size: 1.5rem; color: #7f8c8d; margin-bottom: 15px; }
        .prayer-progress-container { background-color: #ecf0f1; border-radius: 10px; height: 12px; margin: 15px 0; overflow: hidden; }
        .prayer-progress-bar { height: 100%; background-color: #1a5f23; border-radius: 10px; transition: all 0.3s ease; }
        .prayer-date { font-size: 1.1rem; color: #7f8c8d; margin-top: 15px; min-height: 40px; }
        
        .btn { 
            background-color: #1a5f23; 
            color: white; 
            border: none; 
            padding: 15px 30px; 
            border-radius: 50px; 
            font-size: 1.3rem; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            font-family: 'Amiri', serif; 
            margin-top: 15px; 
            width: 100%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 10px; 
        }
        
        .btn:hover { background-color: #13421b; transform: scale(1.05); }
        .btn i { font-size: 1.5rem; }
        .btn:disabled { background-color: #95a5a6; cursor: not-allowed; transform: none; }
        
        body.dark-mode .btn {
            background-color: #4CAF50;
        }
        
        body.dark-mode .btn:hover {
            background-color: #45a049;
        }
        
        .records-section { 
            background-color: white; 
            border-radius: 15px; 
            padding: 25px; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
            margin-bottom: 40px; 
        }
        
        .records-section h2 { 
            color: #1a5f23; 
            margin-bottom: 20px; 
            font-size: 2rem; 
            text-align: center; 
            border-bottom: 2px solid #d4af37; 
            padding-bottom: 10px; 
        }
        
        .filter-section { background-color: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px; border: 1px solid #e9ecef; }
        .filter-section h3 { color: #1a5f23; margin-bottom: 15px; font-size: 1.5rem; text-align: center; }
        .filter-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .filter-group { display: flex; flex-direction: column; }
        .filter-group label { font-size: 1.1rem; margin-bottom: 8px; color: #2c3e50; font-weight: bold; }
        .filter-select, .filter-date { padding: 12px; border: 2px solid #ddd; border-radius: 10px; font-size: 1.1rem; font-family: 'Amiri', serif; transition: all 0.3s ease; }
        .filter-select:focus, .filter-date:focus { outline: none; border-color: #1a5f23; box-shadow: 0 0 0 3px rgba(26, 95, 35, 0.2); }
        .filter-buttons { display: flex; gap: 10px; justify-content: center; margin-top: 10px; }
        .filter-btn { background-color: #d4af37; color: #2c3e50; border: none; padding: 12px 20px; border-radius: 10px; font-size: 1.1rem; cursor: pointer; transition: all 0.3s ease; font-family: 'Amiri', serif; display: flex; align-items: center; gap: 8px; }
        .filter-btn:hover { background-color: #c19b2e; }
        .filter-btn.clear { background-color: #e74c3c; color: white; }
        .filter-btn.clear:hover { background-color: #c0392b; }
        .records-list { max-height: 400px; overflow-y: auto; }
        .record-item { padding: 15px; border-bottom: 1px solid #ecf0f1; display: flex; justify-content: space-between; align-items: center; }
        .record-item:last-child { border-bottom: none; }
        .record-prayer { font-weight: bold; color: #1a5f23; font-size: 1.3rem; }
        .record-date { color: #7f8c8d; }
        .no-records { text-align: center; padding: 30px; color: #7f8c8d; font-size: 1.2rem; }
        
        .controls { 
            display: flex; 
            justify-content: center; 
            gap: 20px; 
            margin-bottom: 40px; 
            flex-wrap: wrap; 
        }
        
        .control-btn { 
            background-color: #d4af37; 
            color: #2c3e50; 
            border: none; 
            padding: 15px 30px; 
            border-radius: 50px; 
            font-size: 1.2rem; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            font-family: 'Amiri', serif; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        
        .control-btn:hover { background-color: #c19b2e; transform: scale(1.05); }
        
        footer { 
            text-align: center; 
            padding: 25px; 
            background-color: #2c3e50; 
            color: white; 
            border-radius: 15px; 
            margin-top: 30px; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
            transition: background-color 0.3s ease;
        }
        
        .motivation { font-size: 1.4rem; font-style: italic; margin-bottom: 15px; color: #f8f9fa; }
        .hadith { font-size: 1.2rem; opacity: 0.9; max-width: 800px; margin: 0 auto; }
        
        /* إصلاح المشكلة للهواتف الصغيرة */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .fixed-header {
                padding: 10px 15px;
            }
            
            .fixed-header h1 {
                font-size: 1.2rem;
            }
            
            .menu-btn {
                width: 35px;
                height: 35px;
                font-size: 1.3rem;
            }
            
            body {
                padding-top: 60px;
            }
            
            header h1 { 
                font-size: 2.2rem; 
                word-break: break-word;
            }
            
            header p {
                font-size: 1.1rem;
            }
            
            .calculator-section, .results-section, .target-section, .stats-section, .prayers-section, .records-section, .page {
                padding: 20px 15px;
            }
            
            .sidebar {
                width: 280px;
                right: -280px;
            }
            
            .target-form {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .target-input-group {
                width: 100%;
            }
            
            .target-input {
                font-size: 1.2rem;
                padding: 12px;
                width: 100%;
                max-width: 100%;
            }
            
            .target-btn {
                font-size: 1.2rem;
                padding: 15px 20px;
                width: 100%;
                max-width: 100%;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            .prayers-section { 
                grid-template-columns: 1fr; 
            }
            
            .stats-section { 
                grid-template-columns: 1fr; 
            }
            
            .controls { 
                flex-direction: column; 
                gap: 10px;
            }
            
            .control-btn, .btn, .filter-btn, .calc-btn, .apply-results-btn { 
                width: 100%; 
                justify-content: center;
            }
            
            .filter-form { 
                grid-template-columns: 1fr; 
            }
            
            .options-grid { 
                grid-template-columns: 1fr; 
            }
            
            .date-range { 
                grid-template-columns: 1fr; 
            }
            
            .calculator-buttons { 
                flex-direction: column; 
                gap: 10px; 
            }
            
            .prayer-selection { 
                grid-template-columns: 1fr; 
            }
            
            .result-details {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .result-item {
                padding: 12px;
            }
            
            .page-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .back-btn {
                align-self: flex-start;
            }
            
            .theme-switch-wrapper {
                padding: 10px 12px;
            }
            
            .theme-text {
                font-size: 1rem;
            }
        }
        
        /* إصلاح إضافي للهواتف الصغيرة جدًا */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            header h1 { 
                font-size: 1.8rem; 
            }
            
            .calculator-section h2, 
            .results-section h2, 
            .target-section h2, 
            .stats-section h2, 
            .prayers-section h2, 
            .records-section h2,
            .page-header h2 {
                font-size: 1.5rem;
            }
            
            .target-btn {
                font-size: 1.1rem;
                padding: 12px 15px;
            }
            
            .target-input {
                font-size: 1.1rem;
                padding: 10px;
            }
            
            .result-details {
                grid-template-columns: 1fr;
            }
            
            .option-card {
                padding: 15px;
            }
            
            .calculator-section, .results-section, .target-section, .stats-section, .prayers-section, .records-section, .page {
                padding: 15px 10px;
            }
        }
        
        .alert { 
            position: fixed; 
            top: 80px; 
            right: 20px; 
            left: 20px; 
            max-width: 500px; 
            margin: 0 auto; 
            padding: 20px; 
            background-color: white; 
            border-radius: 15px; 
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); 
            z-index: 1000; 
            text-align: center; 
            transform: translateY(-100px); 
            opacity: 0; 
            transition: all 0.5s ease; 
        }
        
        body.dark-mode .alert {
            background-color: #2d2d2d;
            color: #e0e0e0;
        }
        
        .alert.show { transform: translateY(0); opacity: 1; }
        .alert.success { border-top: 5px solid #2ecc71; }
        .alert.info { border-top: 5px solid #3498db; }
        .alert.warning { border-top: 5px solid #f39c12; }
        .alert h3 { color: #1a5f23; margin-bottom: 10px; }
        
        body.dark-mode .alert h3 {
            color: #4CAF50;
        }
        
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #1a5f23; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #13421b; }
        
        .steps-progress { display: flex; justify-content: space-between; margin-bottom: 30px; position: relative; }
        .steps-progress::before { content: ''; position: absolute; top: 50%; right: 0; left: 0; height: 4px; background-color: #ddd; transform: translateY(-50%); z-index: 1; }
        .step-progress-bar { 
            position: absolute; 
            top: 50%; 
            right: 0; 
            height: 4px; 
            background-color: #1a5f23; 
            transform: translateY(-50%); 
            z-index: 2; 
            transition: all 0.3s ease; 
            width: 0%;
        }
        
        .step-point { 
            width: 40px; 
            height: 40px; 
            border-radius: 50%; 
            background-color: white; 
            border: 4px solid #ddd; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: bold; 
            color: #666; 
            position: relative; 
            z-index: 3; 
            transition: all 0.3s ease; 
        }
        
        .step-point.active { border-color: #1a5f23; color: #1a5f23; background-color: white; }
        .step-point.completed { border-color: #1a5f23; background-color: #1a5f23; color: white; }
        .step-label { position: absolute; top: 45px; width: 100px; text-align: center; font-size: 0.9rem; color: #666; }
        
        /* تنبيهات وقت الصلاة */
        .prayer-notification {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .prayer-notification h4 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .prayer-notification p {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .notification-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .notification-btn {
            padding: 8px 15px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-family: 'Amiri', serif;
            font-size: 1rem;
        }
        
        .notification-btn.snooze {
            background-color: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }
        
        .notification-btn.dismiss {
            background-color: #dc3545;
            color: white;
        }
        
        .notification-btn.add-prayer {
            background-color: #1a5f23;
            color: white;
        }
        
        /* إضافة خطوط الخط العربية */
        @font-face {
            font-family: 'Amiri';
            font-style: normal;
            font-weight: 400;
            src: url(https://fonts.gstatic.com/s/amiri/v27/J7aRnpd8CGxBHpUutLM.woff2) format('woff2');
        }
        
        @font-face {
            font-family: 'Amiri';
            font-style: normal;
            font-weight: 700;
            src: url(https://fonts.gstatic.com/s/amiri/v27/J7aRnpd8CGxBHpUutLM.woff2) format('woff2');
        }
        
        @font-face {
            font-family: 'Scheherazade New';
            font-style: normal;
            font-weight: 400;
            src: url(https://fonts.gstatic.com/s/scheherazadenew/v8/4UaZrFhTvxVnHDvUkUiHg8jprP4DCwNsOl4p5Is.woff2) format('woff2');
        }
        
        @font-face {
            font-family: 'Scheherazade New';
            font-style: normal;
            font-weight: 700;
            src: url(https://fonts.gstatic.com/s/scheherazadenew/v8/4UaZrFhTvxVnHDvUkUiHg8jprP4DCwNsOl4p5Is.woff2) format('woff2');
        }
        
        /* رموز Font Awesome */
        .fa,
        .fas,
        .far,
        .fal,
        .fab {
            font-family: 'Font Awesome 6 Free';
        }
        
        .fa,
        .fas {
            font-weight: 900;
        }
        
        .far {
            font-weight: 400;
        }
    </style>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Arabic Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- الهيدر الثابت -->
    <div class="fixed-header" id="fixedHeader" style="display: none;">
        <button class="menu-btn" onclick="openSidebar()">
            <i class="fas fa-bars"></i>
        </button>
        <h1><i class="fas fa-mosque"></i> تطبيق صلاة القضاء</h1>
        <button class="back-to-calc-btn" id="backToCalcBtn" onclick="showMainPage()">
            <i class="fas fa-home"></i> الرئيسية
        </button>
    </div>

    <!-- القائمة الجانبية -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2><i class="fas fa-bars"></i> القائمة</h2>
            <button class="close-sidebar" onclick="closeSidebar()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="sidebar-section">
            <h3><i class="fas fa-home"></i> التنقل</h3>
            <button class="sidebar-btn" onclick="showMainPage(); closeSidebar();">
                <i class="fas fa-home"></i> الصفحة الرئيسية
            </button>
            <button class="sidebar-btn" onclick="backToCalculator(); closeSidebar();">
                <i class="fas fa-calculator"></i> إعادة الحساب
            </button>
        </div>
        
        <div class="sidebar-section">
            <h3><i class="fas fa-edit"></i> الصلوات المطلوبة</h3>
            <button class="sidebar-btn" onclick="showTargetPage(); closeSidebar();">
                <i class="fas fa-edit"></i> تحديث الأعداد المطلوبة
            </button>
        </div>
        
        <div class="sidebar-section">
            <h3><i class="fas fa-history"></i> السجلات</h3>
            <button class="sidebar-btn" onclick="showRecordsPage(); closeSidebar();">
                <i class="fas fa-history"></i> فتح سجل صلوات القضاء
            </button>
        </div>
        
        <div class="sidebar-section">
            <h3><i class="fas fa-cog"></i> الإعدادات</h3>
            <div class="theme-switch-wrapper" onclick="toggleThemeBySwitch()">
                <div class="theme-label">
                    <i class="fas fa-adjust theme-icon"></i>
                    <span class="theme-text">تغيير المود</span>
                    <div class="theme-switch">
                        <input type="checkbox" id="themeSwitch">
                        <label class="slider" for="themeSwitch">
                            <div class="slider-icons">
                                <i class="fas fa-sun sun"></i>
                                <i class="fas fa-moon moon"></i>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
            <button class="sidebar-btn" onclick="resetAllPrayers(); closeSidebar();">
                <i class="fas fa-redo"></i> إعادة تعيين جميع الصلوات
            </button>
        </div>
    </div>
    
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

    <div class="container">
        <!-- الصفحة الرئيسية -->
        <div class="page active" id="mainPage">
            <header>
                <h1><i class="fas fa-mosque"></i> تطبيق صلاة القضاء</h1>
                <p>سجل صلوات القضاء التي تؤديها واتبع عدد الصلوات المتبقية لك</p>
            </header>

            <!-- قسم تنبيهات الصلاة -->
            <div id="prayerNotifications"></div>

            <!-- قسم الآلة الحاسبة -->
            <section class="calculator-section" id="calculatorSection">
                <h2><i class="fas fa-calculator"></i> حساب الصلوات المطلوبة قضاؤها</h2>
                
                <div class="steps-progress">
                    <div class="step-progress-bar" id="stepProgressBar"></div>
                    
                    <div class="step-point active" id="step1Point">
                        1
                        <div class="step-label">اختيار الطريقة</div>
                    </div>
                    
                    <div class="step-point" id="step2Point">
                        2
                        <div class="step-label">تحديد التفاصيل</div>
                    </div>
                    
                    <div class="step-point" id="step3Point">
                        3
                        <div class="step-label">اختيار الصلوات</div>
                    </div>
                    
                    <div class="step-point" id="step4Point">
                        4
                        <div class="step-label">النتائج</div>
                    </div>
                </div>
                
                <div class="calculator-step active" id="step1">
                    <h3 class="step-header">كيف تريد حساب الصلوات المطلوبة؟</h3>
                    <p class="step-description">اختر الطريقة المناسبة لحساب عدد الصلوات التي تحتاج إلى قضائها</p>
                    
                    <div class="options-grid">
                        <div class="option-card" onclick="selectMethod('days')">
                            <div class="option-icon">
                                <i class="fas fa-calendar-day"></i>
                            </div>
                            <div class="option-title">حساب بالأيام</div>
                            <div class="option-desc">أدخل عدد الأيام التي فاتتك فيها الصلاة</div>
                        </div>
                        
                        <div class="option-card" onclick="selectMethod('months')">
                            <div class="option-icon">
                                <i class="fas fa-calendar-week"></i>
                            </div>
                            <div class="option-title">حساب بالأشهر</div>
                            <div class="option-desc">أدخل عدد الأشهر التي فاتتك فيها الصلاة</div>
                        </div>
                        
                        <div class="option-card" onclick="selectMethod('years')">
                            <div class="option-icon">
                                <i class="fas fa-calendar"></i>
                            </div>
                            <div class="option-title">حساب بالسنوات</div>
                            <div class="option-desc">أدخل عدد السنوات التي فاتتك فيها الصلاة</div>
                        </div>
                        
                        <div class="option-card" onclick="selectMethod('range')">
                            <div class="option-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div class="option-title">حساب بالمدة</div>
                            <div class="option-desc">حدد تاريخ البدء والانتهاء للفترة التي فاتتك فيها الصلاة</div>
                        </div>
                    </div>
                    
                    <div class="calculator-buttons">
                        <button class="calc-btn" disabled>
                            <i class="fas fa-arrow-right"></i> السابق
                        </button>
                        <button class="calc-btn next" onclick="nextStep()" id="step1NextBtn" disabled>
                            التالي <i class="fas fa-arrow-left"></i>
                        </button>
                    </div>
                </div>
                
                <div class="calculator-step" id="step2">
                    <h3 class="step-header" id="step2Header">أدخل التفاصيل</h3>
                    <p class="step-description" id="step2Description">أدخل التفاصيل المطلوبة لحساب عدد الصلوات</p>
                    
                    <div id="step2Content">
                        </div>
                    
                    <div class="calculator-buttons">
                        <button class="calc-btn" onclick="prevStep()">
                            <i class="fas fa-arrow-right"></i> السابق
                        </button>
                        <button class="calc-btn next" onclick="nextStep()" id="step2NextBtn" disabled>
                            التالي <i class="fas fa-arrow-left"></i>
                        </button>
                    </div>
                </div>
                
                <div class="calculator-step" id="step3">
                    <h3 class="step-header">اختر الصلوات المطلوبة</h3>
                    <p class="step-description">اختر الصلوات التي تريد حساب عددها للقضاء</p>
                    
                    <div class="prayer-selection" id="prayerSelection">
                        </div>
                    
                    <div class="calculator-buttons">
                        <button class="calc-btn" onclick="prevStep()">
                            <i class="fas fa-arrow-right"></i> السابق
                        </button>
                        <button class="calc-btn next" onclick="nextStep()" id="step3NextBtn" disabled>
                            التالي <i class="fas fa-arrow-left"></i>
                        </button>
                    </div>
                </div>
                
                <div class="calculator-step" id="step4">
                    <h3 class="step-header">نتائج الحساب</h3>
                    <p class="step-description">إليك عدد الصلوات المطلوبة قضاؤها حسب المعلومات التي أدخلتها</p>
                    
                    <div id="step4Content">
                        </div>
                    
                    <div class="calculator-buttons">
                        <button class="calc-btn" onclick="prevStep()">
                            <i class="fas fa-arrow-right"></i> السابق
                        </button>
                        <button class="calc-btn next" onclick="applyCalculationResults()">
                            تطبيق النتائج <i class="fas fa-check"></i>
                        </button>
                    </div>
                </div>
            </section>

            <!-- الأقسام الرئيسية (تظهر بعد الحساب) -->
            <div class="main-sections" id="mainSections">
                <section class="stats-section" id="statsSection">
                </section>

                <section class="prayers-section" id="prayersSection">
                </section>

                <div class="controls" id="controlsSection">
                </div>

                <footer>
                    <p class="motivation">"ما من عبد يصلي لله اثنتي عشرة ركعة تطوعًا في يوم وليلة إلا بنى الله له بيتًا في الجنة"</p>
                    <p class="hadith">- حديث شريف -</p>
                    <p style="margin-top: 15px;">تطبيق صلاة القضاء &copy; 2023 | اجعل قضاء الصلوات الفائتة عادة شهرية</p>
                </footer>
            </div>
        </div>

        <!-- صفحة الصلوات المطلوبة -->
        <div class="page" id="targetPage">
            <div class="page-header">
                <h2><i class="fas fa-edit"></i> الصلوات المطلوبة قضاؤها</h2>
                <button class="back-btn" onclick="showMainPage()">
                    <i class="fas fa-arrow-right"></i> العودة للصفحة الرئيسية
                </button>
            </div>
            
            <div class="target-section">
                <div id="targetPageContent">
                    <!-- سيتم ملء هذا القسم عن طريق JavaScript -->
                </div>
            </div>
        </div>

        <!-- صفحة سجل الصلوات -->
        <div class="page" id="recordsPage">
            <div class="page-header">
                <h2><i class="fas fa-history"></i> سجل صلوات القضاء</h2>
                <button class="back-btn" onclick="showMainPage()">
                    <i class="fas fa-arrow-right"></i> العودة للصفحة الرئيسية
                </button>
            </div>
            
            <div class="records-section">
                <div id="recordsPageContent">
                    <!-- سيتم ملء هذا القسم عن طريق JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <div class="alert" id="alertMessage">
        <h3 id="alertTitle">عنوان التنبيه</h3>
        <p id="alertText">نص التنبيه</p>
    </div>

    <script>
        // بيانات التطبيق
        const prayers = [
            { id: 'fajr', name: 'صلاة الفجر', icon: 'fas fa-sun', color: '#3498db', count: 0, target: 0, records: [] },
            { id: 'dhuhr', name: 'صلاة الظهر', icon: 'fas fa-sun', color: '#f39c12', count: 0, target: 0, records: [] },
            { id: 'asr', name: 'صلاة العصر', icon: 'fas fa-sun', color: '#e67e22', count: 0, target: 0, records: [] },
            { id: 'maghrib', name: 'صلاة المغرب', icon: 'fas fa-moon', color: '#9b59b6', count: 0, target: 0, records: [] },
            { id: 'isha', name: 'صلاة العشاء', icon: 'fas fa-moon', color: '#34495e', count: 0, target: 0, records: [] }
        ];

        // أوقات الإشعارات حسب المتطلبات
        const notificationTimes = {
            'fajr': { hour: 6, minute: 0 },      // 6:00 صباحاً
            'dhuhr': { hour: 12, minute: 45 },   // 12:45 ظهراً
            'asr': { hour: 12, minute: 45 },     // 12:45 ظهراً (نفس وقت الظهر)
            'maghrib': { hour: 19, minute: 30 }, // 7:30 مساءً
            'isha': { hour: 19, minute: 30 }     // 7:30 مساءً (نفس وقت المغرب)
        };

        // متغيرات الحساب
        let currentStep = 1;
        let calculationMethod = null;
        let calculationDetails = {};
        let selectedPrayers = [];
        let calculationResults = {};
        let userSelectedPrayers = [];
        let calculationCompleted = false;
        let darkMode = false; // متغير لتتبع وضع التطبيق
        
        // متغيرات التنبيهات
        let notificationTimer = null;
        let prayerTimers = {};
        
        // الصفحة الحالية
        let currentPage = 'main';

        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            setupCalculator();
            updateProgressBar(1);
            
            // التحقق مما إذا تم إكمال الحساب من قبل
            if (calculationCompleted) {
                showMainSections();
            } else {
                showCalculator();
            }
            
            // تحميل وضع التطبيق
            loadTheme();
            
            // بدء نظام التنبيهات
            startNotificationSystem();
            
            // إعداد زر العودة للحساب في الهيدر
            setupBackButton();
            
            // إعداد معالجات الأحداث للصفحات
            setupPageEventListeners();
        });

        // إعداد معالج الحساب
        function setupCalculator() {
            setupPrayerSelection();
        }

        // تحميل جميع البيانات من localStorage
        function loadAllData() {
            const savedData = localStorage.getItem('qadaaPrayersData');
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    prayers.forEach(prayer => {
                        const savedPrayer = parsedData.find(p => p.id === prayer.id);
                        if (savedPrayer) {
                            prayer.count = savedPrayer.count || 0;
                            prayer.target = savedPrayer.target || 0;
                            prayer.records = savedPrayer.records || [];
                        }
                    });
                } catch (e) {
                    console.error('خطأ في تحميل البيانات:', e);
                }
            }
            
            // تحميل الصلوات المختارة
            const savedSelected = localStorage.getItem('userSelectedPrayers');
            if (savedSelected) {
                try {
                    userSelectedPrayers = JSON.parse(savedSelected);
                } catch (e) {
                    console.error('خطأ في تحميل الصلوات المختارة:', e);
                }
            }
            
            // تحميل تفاصيل الحساب
            const savedCalcDetails = localStorage.getItem('calculationDetails');
            if (savedCalcDetails) {
                try {
                    calculationDetails = JSON.parse(savedCalcDetails);
                    if (calculationDetails.method) {
                        calculationMethod = calculationDetails.method;
                    }
                } catch (e) {
                    console.error('خطأ في تحميل تفاصيل الحساب:', e);
                }
            }
            
            // تحميل الصلوات المحددة للحساب
            const savedCalcPrayers = localStorage.getItem('selectedPrayers');
            if (savedCalcPrayers) {
                try {
                    selectedPrayers = JSON.parse(savedCalcPrayers);
                } catch (e) {
                    console.error('خطأ في تحميل الصلوات المحددة:', e);
                }
            }
            
            // تحميل حالة إكمال الحساب
            const savedCompleted = localStorage.getItem('calculationCompleted');
            if (savedCompleted) {
                try {
                    calculationCompleted = JSON.parse(savedCompleted);
                } catch (e) {
                    console.error('خطأ في تحميل حالة الحساب:', e);
                }
            }
        }

        // حفظ جميع البيانات في localStorage
        function saveAllData() {
            try {
                localStorage.setItem('qadaaPrayersData', JSON.stringify(prayers));
                localStorage.setItem('userSelectedPrayers', JSON.stringify(userSelectedPrayers));
                localStorage.setItem('calculationDetails', JSON.stringify(calculationDetails));
                localStorage.setItem('selectedPrayers', JSON.stringify(selectedPrayers));
                localStorage.setItem('calculationCompleted', JSON.stringify(calculationCompleted));
            } catch (e) {
                console.error('خطأ في حفظ البيانات:', e);
                showAlert('خطأ', 'حدث خطأ في حفظ البيانات', 'warning');
            }
        }

        // عرض معالج الحساب وإخفاء الأقسام الأخرى
        function showCalculator() {
            document.getElementById('calculatorSection').style.display = 'block';
            document.getElementById('mainSections').classList.remove('show');
            document.getElementById('fixedHeader').style.display = 'none';
            document.getElementById('sidebar').classList.remove('open');
            document.getElementById('sidebarOverlay').classList.remove('show');
        }

        // عرض الأقسام الرئيسية بعد انتهاء الحساب
        function showMainSections() {
            document.getElementById('calculatorSection').style.display = 'none';
            document.getElementById('mainSections').classList.add('show');
            document.getElementById('fixedHeader').style.display = 'flex';
            updateAllSections();
        }

        // تحديث جميع الأقسام
        function updateAllSections() {
            renderPrayerCards();
            updateStats();
            setupControls();
            checkPrayerNotifications();
        }

        // فتح القائمة الجانبية
        function openSidebar() {
            document.getElementById('sidebar').classList.add('open');
            document.getElementById('sidebarOverlay').classList.add('show');
        }

        // إغلاق القائمة الجانبية
        function closeSidebar() {
            document.getElementById('sidebar').classList.remove('open');
            document.getElementById('sidebarOverlay').classList.remove('show');
        }

        // إعداد زر العودة للحساب في الهيدر
        function setupBackButton() {
            const backBtn = document.getElementById('backToCalcBtn');
            if (currentPage !== 'main') {
                backBtn.classList.add('show');
            } else {
                backBtn.classList.remove('show');
            }
        }

        // إعداد معالجات الأحداث للصفحات
        function setupPageEventListeners() {
            // عند فتح صفحة الأهداف، قم بتحميل المحتوى
            document.getElementById('targetPage').addEventListener('pageShow', function() {
                renderTargetPage();
            });
            
            // عند فتح صفحة السجلات، قم بتحميل المحتوى
            document.getElementById('recordsPage').addEventListener('pageShow', function() {
                renderRecordsPage();
            });
        }

        // عرض الصفحة الرئيسية
        function showMainPage() {
            currentPage = 'main';
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById('mainPage').classList.add('active');
            document.getElementById('fixedHeader').style.display = 'flex';
            setupBackButton();
            
            // تحديث المحتوى إذا كان الحساب مكتملاً
            if (calculationCompleted) {
                showMainSections();
            } else {
                showCalculator();
            }
        }

        // عرض صفحة الصلوات المطلوبة
        function showTargetPage() {
            if (!calculationCompleted) {
                showAlert('لم يتم الحساب', 'يجب إكمال عملية الحساب أولاً', 'warning');
                return;
            }
            
            currentPage = 'target';
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById('targetPage').classList.add('active');
            document.getElementById('fixedHeader').style.display = 'flex';
            setupBackButton();
            
            // تشغيل حدث pageShow
            const event = new Event('pageShow');
            document.getElementById('targetPage').dispatchEvent(event);
            
            // استدعاء renderTargetPage مباشرة للتأكد من عرض المحتوى
            renderTargetPage();
        }

        // عرض صفحة السجلات
        function showRecordsPage() {
            if (!calculationCompleted) {
                showAlert('لم يتم الحساب', 'يجب إكمال عملية الحساب أولاً', 'warning');
                return;
            }
            
            currentPage = 'records';
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById('recordsPage').classList.add('active');
            document.getElementById('fixedHeader').style.display = 'flex';
            setupBackButton();
            
            // تشغيل حدث pageShow
            const event = new Event('pageShow');
            document.getElementById('recordsPage').dispatchEvent(event);
            
            // استدعاء renderRecordsPage مباشرة للتأكد من عرض المحتوى
            renderRecordsPage();
        }

        // عرض محتوى صفحة الصلوات المطلوبة
        function renderTargetPage() {
            const targetPageContent = document.getElementById('targetPageContent');
            
            const prayersToShow = userSelectedPrayers.length > 0 ? 
                prayers.filter(prayer => userSelectedPrayers.includes(prayer.id)) : 
                prayers;
            
            let formHTML = `
                <div class="target-info" style="text-align: center; margin-bottom: 30px; padding: 20px; background-color: #f8f9fa; border-radius: 10px;">
                    <h3 style="color: #1a5f23; margin-bottom: 10px;"><i class="fas fa-info-circle"></i> معلومات الصلوات المطلوبة</h3>
                    <p style="color: #666; font-size: 1.1rem;">يمكنك هنا تحديث عدد الصلوات المطلوبة لكل صلاة. أدخل العدد الجديد واضغط على زر التحديث.</p>
                </div>
                <form class="target-form" id="targetForm" onsubmit="updateTargets(event)">
            `;
            
            prayersToShow.forEach(prayer => {
                const progressPercent = prayer.target > 0 ? Math.min((prayer.count / prayer.target) * 100, 100) : 0;
                formHTML += `
                    <div class="target-input-group">
                        <label for="${prayer.id}Target">
                            <i class="${prayer.icon}" style="color: ${prayer.color}; margin-left: 5px;"></i>
                            ${prayer.name}
                            <div style="font-size: 0.9rem; color: #666; margin-top: 5px;">
                                (أكملت ${prayer.count} من ${prayer.target} - ${Math.round(progressPercent)}%)
                            </div>
                        </label>
                        <input type="number" id="${prayer.id}Target" class="target-input" 
                               min="0" value="${prayer.target}" placeholder="عدد الصلوات المطلوبة" required>
                    </div>
                `;
            });
            
            formHTML += `
                    <div style="grid-column: 1 / -1; text-align: center; margin-top: 20px;">
                        <button type="submit" class="target-btn">
                            <i class="fas fa-save"></i> تحديث الأعداد المطلوبة
                        </button>
                        <button type="button" class="target-btn" onclick="resetTargets()" style="background-color: #e74c3c; margin-top: 10px;">
                            <i class="fas fa-redo"></i> إعادة تعيين جميع الأهداف
                        </button>
                    </div>
                </form>
            `;
            
            targetPageContent.innerHTML = formHTML;
        }

        // عرض محتوى صفحة السجلات
        function renderRecordsPage() {
            const recordsPageContent = document.getElementById('recordsPageContent');
            
            // حساب إجمالي السجلات
            const totalRecords = prayers.reduce((total, prayer) => total + prayer.records.length, 0);
            
            let recordsHTML = `
                <div class="records-summary" style="text-align: center; margin-bottom: 30px; padding: 20px; background-color: #f8f9fa; border-radius: 10px;">
                    <h3 style="color: #1a5f23; margin-bottom: 10px;"><i class="fas fa-chart-bar"></i> ملخص السجلات</h3>
                    <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-top: 15px;">
                        <div style="background-color: white; padding: 15px; border-radius: 10px; min-width: 150px;">
                            <div style="font-size: 2.5rem; color: #1a5f23; font-weight: bold;">${totalRecords}</div>
                            <div style="color: #666;">إجمالي السجلات</div>
                        </div>
            `;
            
            prayers.forEach(prayer => {
                recordsHTML += `
                    <div style="background-color: white; padding: 15px; border-radius: 10px; min-width: 150px;">
                        <div style="font-size: 1.8rem; color: ${prayer.color}; font-weight: bold;">${prayer.records.length}</div>
                        <div style="color: #666;">${prayer.name}</div>
                    </div>
                `;
            });
            
            recordsHTML += `
                    </div>
                </div>
                <div class="filter-section">
                    <h3><i class="fas fa-filter"></i> تصفية السجلات</h3>
                    <form class="filter-form" id="filterForm">
                        <div class="filter-group">
                            <label for="filterPrayer">تصفية حسب الصلاة</label>
                            <select id="filterPrayer" class="filter-select">
                                <option value="all">جميع الصلوات</option>
            `;
            
            prayers.forEach(prayer => {
                recordsHTML += `<option value="${prayer.id}">${prayer.name}</option>`;
            });
            
            recordsHTML += `
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="filterFromDate">من تاريخ</label>
                            <input type="date" id="filterFromDate" class="filter-date">
                        </div>
                        <div class="filter-group">
                            <label for="filterToDate">إلى تاريخ</label>
                            <input type="date" id="filterToDate" class="filter-date">
                        </div>
                        <div class="filter-buttons">
                            <button type="button" class="filter-btn" onclick="applyRecordsFilter()">
                                <i class="fas fa-search"></i> تطبيق التصفية
                            </button>
                            <button type="button" class="filter-btn clear" onclick="clearRecordsFilter()">
                                <i class="fas fa-times"></i> مسح التصفية
                            </button>
                        </div>
                    </form>
                </div>
                <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                    <button class="filter-btn" onclick="exportRecords()" style="background-color: #2ecc71;">
                        <i class="fas fa-download"></i> تصدير السجلات
                    </button>
                    <button class="filter-btn danger" onclick="clearAllRecords()" style="background-color: #e74c3c;">
                        <i class="fas fa-trash-alt"></i> حذف جميع السجلات
                    </button>
                </div>
                <div class="records-list" id="recordsList"></div>
            `;
            
            recordsPageContent.innerHTML = recordsHTML;
            
            // إعداد التواريخ
            setupFilterDates();
            
            // عرض السجلات
            renderRecords();
        }

        // اختيار طريقة الحساب
        function selectMethod(method) {
            calculationMethod = method;
            document.querySelectorAll('.option-card').forEach(card => {
                card.classList.remove('selected');
            });
            const selectedCard = document.querySelector(`.option-card[onclick*="${method}"]`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
            }
            document.getElementById('step1NextBtn').disabled = false;
            saveAllData();
        }

        // التقدم للخطوة التالية
        function nextStep() {
            if (currentStep < 4) {
                if (currentStep === 1) {
                    if (!calculationMethod) {
                        showAlert('اختر طريقة', 'يرجى اختيار طريقة حساب الصلوات المطلوبة', 'warning');
                        return;
                    }
                    setupStep2();
                }
                
                if (currentStep === 2) {
                    if (!validateStep2()) {
                        return;
                    }
                    saveStep2Details();
                    setupStep3();
                }
                
                if (currentStep === 3) {
                    if (selectedPrayers.length === 0) {
                        showAlert('اختر صلوات', 'يرجى اختيار صلاة واحدة على الأقل', 'warning');
                        return;
                    }
                    calculateResults();
                    setupStep4();
                }
                
                // تحديث الخطوة الحالية أولاً
                document.getElementById(`step${currentStep}`).classList.remove('active');
                currentStep++;
                document.getElementById(`step${currentStep}`).classList.add('active');
                
                // ثم تحديث شريط التقدم
                updateProgressBar(currentStep);
                saveAllData();
            }
        }

        // العودة للخطوة السابقة
        function prevStep() {
            if (currentStep > 1) {
                document.getElementById(`step${currentStep}`).classList.remove('active');
                currentStep--;
                document.getElementById(`step${currentStep}`).classList.add('active');
                
                // تحديث شريط التقدم
                updateProgressBar(currentStep);
                saveAllData();
            }
        }

        // تحديث شريط التقدم
        function updateProgressBar(step) {
            const progressPercent = (step - 1) * 33.33;
            document.getElementById('stepProgressBar').style.width = `${progressPercent}%`;
            
            // تحديث نقاط الخطوات
            for (let i = 1; i <= 4; i++) {
                const point = document.getElementById(`step${i}Point`);
                if (i < step) {
                    point.className = 'step-point completed';
                } else if (i === step) {
                    point.className = 'step-point active';
                } else {
                    point.className = 'step-point';
                }
            }
        }

        // إعداد الخطوة 2 بناءً على الطريقة المختارة
        function setupStep2() {
            const step2Header = document.getElementById('step2Header');
            const step2Description = document.getElementById('step2Description');
            const step2Content = document.getElementById('step2Content');
            const nextBtn = document.getElementById('step2NextBtn');
            
            nextBtn.disabled = true;
            
            let contentHTML = '';
            switch(calculationMethod) {
                case 'days':
                    step2Header.textContent = 'حساب بالأيام';
                    step2Description.textContent = 'أدخل عدد الأيام التي فاتتك فيها الصلاة';
                    contentHTML = `
                        <div class="input-group">
                            <label for="daysCount"><i class="fas fa-calendar-day"></i> عدد الأيام</label>
                            <input type="number" id="daysCount" class="input-control" min="1" placeholder="أدخل عدد الأيام" value="${calculationDetails.days || ''}">
                            <p style="margin-top: 10px; color: #666; font-size: 1rem;">كل يوم يحتوي على 5 صلوات (فجر، ظهر، عصر، مغرب، عشاء)</p>
                        </div>
                    `;
                    break;
                    
                case 'months':
                    step2Header.textContent = 'حساب بالأشهر';
                    step2Description.textContent = 'أدخل عدد الأشهر التي فاتتك فيها الصلاة';
                    contentHTML = `
                        <div class="input-group">
                            <label for="monthsCount"><i class="fas fa-calendar-week"></i> عدد الأشهر</label>
                            <input type="number" id="monthsCount" class="input-control" min="1" placeholder="أدخل عدد الأشهر" value="${calculationDetails.months || ''}">
                            <p style="margin-top: 10px; color: #666; font-size: 1rem;">كل شهر يحتوي تقريباً على 30 يوم × 5 صلوات = 150 صلاة</p>
                        </div>
                    `;
                    break;
                    
                case 'years':
                    step2Header.textContent = 'حساب بالسنوات';
                    step2Description.textContent = 'أدخل عدد السنوات التي فاتتك فيها الصلاة';
                    contentHTML = `
                        <div class="input-group">
                            <label for="yearsCount"><i class="fas fa-calendar"></i> عدد السنوات</label>
                            <input type="number" id="yearsCount" class="input-control" min="1" placeholder="أدخل عدد السنوات" value="${calculationDetails.years || ''}">
                            <p style="margin-top: 10px; color: #666; font-size: 1rem;">كل سنة تحتوي تقريباً على 365 يوم × 5 صلوات = 1825 صلاة</p>
                        </div>
                    `;
                    break;
                    
                case 'range':
                    step2Header.textContent = 'حساب بالمدة';
                    step2Description.textContent = 'حدد تاريخ البدء والانتهاء للفترة التي فاتتك فيها الصلاة';
                    const today = new Date();
                    const todayFormatted = today.toISOString().split('T')[0];
                    const lastMonth = new Date();
                    lastMonth.setMonth(today.getMonth() - 1);
                    const lastMonthFormatted = lastMonth.toISOString().split('T')[0];
                    
                    contentHTML = `
                        <div class="input-group">
                            <label><i class="fas fa-calendar-alt"></i> الفترة الزمنية</label>
                            <div class="date-range">
                                <div>
                                    <label for="startDate" style="font-size: 1rem;">تاريخ البدء</label>
                                    <input type="date" id="startDate" class="input-control" value="${calculationDetails.startDate || lastMonthFormatted}">
                                </div>
                                <div>
                                    <label for="endDate" style="font-size: 1rem;">تاريخ الانتهاء</label>
                                    <input type="date" id="endDate" class="input-control" value="${calculationDetails.endDate || todayFormatted}">
                                </div>
                            </div>
                            <p style="margin-top: 10px; color: #666; font-size: 1rem;">سيتم حساب عدد الأيام بين التاريخين ثم عدد الصلوات</p>
                        </div>
                    `;
                    break;
            }
            
            step2Content.innerHTML = contentHTML;

            if (calculationMethod === 'days') {
                const input = document.getElementById('daysCount');
                input.addEventListener('input', function() {
                    nextBtn.disabled = !(this.value && parseInt(this.value) > 0);
                });
                input.addEventListener('keyup', function() {
                    nextBtn.disabled = !(this.value && parseInt(this.value) > 0);
                });
                nextBtn.disabled = !(input.value && parseInt(input.value) > 0);
            } 
            else if (calculationMethod === 'months') {
                const input = document.getElementById('monthsCount');
                input.addEventListener('input', function() {
                    nextBtn.disabled = !(this.value && parseInt(this.value) > 0);
                });
                input.addEventListener('keyup', function() {
                    nextBtn.disabled = !(this.value && parseInt(this.value) > 0);
                });
                nextBtn.disabled = !(input.value && parseInt(input.value) > 0);
            }
            else if (calculationMethod === 'years') {
                const input = document.getElementById('yearsCount');
                input.addEventListener('input', function() {
                    nextBtn.disabled = !(this.value && parseInt(this.value) > 0);
                });
                input.addEventListener('keyup', function() {
                    nextBtn.disabled = !(this.value && parseInt(this.value) > 0);
                });
                nextBtn.disabled = !(input.value && parseInt(input.value) > 0);
            }
            else if (calculationMethod === 'range') {
                const startDateField = document.getElementById('startDate');
                const endDateField = document.getElementById('endDate');
                
                const validateRange = () => {
                    if (startDateField.value && endDateField.value) {
                        nextBtn.disabled = false;
                    } else {
                        nextBtn.disabled = true;
                    }
                };
                
                startDateField.addEventListener('input', validateRange);
                startDateField.addEventListener('change', validateRange);
                endDateField.addEventListener('input', validateRange);
                endDateField.addEventListener('change', validateRange);
                
                validateRange();
            }
        }

        // التحقق من صحة بيانات الخطوة 2
        function validateStep2() {
            let isValid = true;
            let errorMessage = '';
            
            switch(calculationMethod) {
                case 'days':
                    const daysElement = document.getElementById('daysCount');
                    const daysCount = daysElement ? parseInt(daysElement.value) : 0;
                    if (!daysCount || daysCount < 1 || isNaN(daysCount)) {
                        isValid = false;
                        errorMessage = 'يرجى إدخال عدد أيام صحيح';
                    } else if (daysCount > 3650) {
                        isValid = false;
                        errorMessage = 'عدد الأيام كبير جداً، يرجى التأكد من الرقم';
                    }
                    break;
                case 'months':
                    const monthsElement = document.getElementById('monthsCount');
                    const monthsCount = monthsElement ? parseInt(monthsElement.value) : 0;
                    if (!monthsCount || monthsCount < 1 || isNaN(monthsCount)) {
                        isValid = false;
                        errorMessage = 'يرجى إدخال عدد أشهر صحيح';
                    } else if (monthsCount > 120) {
                        isValid = false;
                        errorMessage = 'عدد الأشهر كبير جداً، يرجى التأكد من الرقم';
                    }
                    break;
                case 'years':
                    const yearsElement = document.getElementById('yearsCount');
                    const yearsCount = yearsElement ? parseInt(yearsElement.value) : 0;
                    if (!yearsCount || yearsCount < 1 || isNaN(yearsCount)) {
                        isValid = false;
                        errorMessage = 'يرجى إدخال عدد سنوات صحيح';
                    } else if (yearsCount > 10) {
                        isValid = false;
                        errorMessage = 'عدد السنوات كبير جداً، يرجى التأكد من الرقم';
                    }
                    break;
                case 'range':
                    const startDate = document.getElementById('startDate').value;
                    const endDate = document.getElementById('endDate').value;
                    
                    if (!startDate || !endDate) {
                        isValid = false;
                        errorMessage = 'يرجى إدخال تاريخ البدء والانتهاء';
                    } else {
                        const start = new Date(startDate);
                        const end = new Date(endDate);
                        
                        if (start > end) {
                            isValid = false;
                            errorMessage = 'تاريخ البدء يجب أن يكون قبل تاريخ الانتهاء';
                        } else {
                            const diffTime = Math.abs(end - start);
                            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                            if (diffDays > 3650) {
                                isValid = false;
                                errorMessage = 'الفترة الزمنية طويلة جداً، يرجى التأكد من التواريخ';
                            }
                        }
                    }
                    break;
                default:
                    isValid = false;
                    errorMessage = 'طريقة الحساب غير محددة';
            }
            
            if (!isValid) {
                showAlert('خطأ في الإدخال', errorMessage, 'warning');
                return false;
            }
            
            return true;
        }

        // حفظ تفاصيل الخطوة 2
        function saveStep2Details() {
            calculationDetails.method = calculationMethod;
            switch(calculationMethod) {
                case 'days': {
                    calculationDetails.days = parseInt(document.getElementById('daysCount').value);
                    calculationDetails.inputValue = calculationDetails.days;
                    break;
                }
                case 'months': {
                    calculationDetails.months = parseInt(document.getElementById('monthsCount').value);
                    calculationDetails.days = calculationDetails.months * 30;
                    calculationDetails.inputValue = calculationDetails.months;
                    break;
                }
                case 'years': {
                    calculationDetails.years = parseInt(document.getElementById('yearsCount').value);
                    calculationDetails.days = calculationDetails.years * 365;
                    calculationDetails.inputValue = calculationDetails.years;
                    break;
                }
                case 'range': {
                    const startDate = document.getElementById('startDate').value;
                    const endDate = document.getElementById('endDate').value;
                    const start = new Date(startDate);
                    const end = new Date(endDate);
                    const diffTime = Math.abs(end - start);
                    calculationDetails.days = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    calculationDetails.startDate = startDate;
                    calculationDetails.endDate = endDate;
                    calculationDetails.inputValue = calculationDetails.days;
                    break;
                }
            }
            saveAllData();
        }
        
        // إعداد الخطوة 3
        function setupStep3() {
            setupPrayerSelection();
            const nextBtn = document.getElementById('step3NextBtn');
            nextBtn.disabled = selectedPrayers.length === 0;
        }

        // إعداد اختيارات الصلوات في الخطوة 3
        function setupPrayerSelection() {
            const prayerSelection = document.getElementById('prayerSelection');
            prayerSelection.innerHTML = '';
            
            const allOption = document.createElement('div');
            allOption.className = 'prayer-option all-selected';
            if (selectedPrayers.length === prayers.length) {
                allOption.classList.add('selected');
            }
            allOption.onclick = function() { toggleAllPrayers(); };
            allOption.innerHTML = `
                <div class="prayer-name">كل الصلوات</div>
                <div style="font-size: 1rem; color: #666;">اختيار جميع الصلوات</div>
            `;
            prayerSelection.appendChild(allOption);
            
            prayers.forEach(prayer => {
                const prayerOption = document.createElement('div');
                const isSelected = selectedPrayers.includes(prayer.id);
                prayerOption.className = isSelected ? 'prayer-option selected' : 'prayer-option';
                prayerOption.onclick = function() { togglePrayerSelection(prayer.id); };
                prayerOption.innerHTML = `
                    <div class="prayer-name">${prayer.name}</div>
                `;
                prayerSelection.appendChild(prayerOption);
            });
            
            document.getElementById('step3NextBtn').disabled = selectedPrayers.length === 0;
        }

        // تبديل تحديد كل الصلوات
        function toggleAllPrayers() {
            if (selectedPrayers.length === prayers.length) {
                selectedPrayers = [];
            } else {
                selectedPrayers = prayers.map(p => p.id);
            }
            
            document.querySelectorAll('.prayer-option').forEach((option, index) => {
                if (index === 0) {
                    option.classList.toggle('selected', selectedPrayers.length === prayers.length);
                } else {
                    const prayerId = prayers[index-1].id;
                    option.classList.toggle('selected', selectedPrayers.includes(prayerId));
                }
            });
            
            document.getElementById('step3NextBtn').disabled = selectedPrayers.length === 0;
            saveAllData();
        }

        // تبديل تحديد صلاة فردية
        function togglePrayerSelection(prayerId) {
            const index = selectedPrayers.indexOf(prayerId);
            if (index === -1) {
                selectedPrayers.push(prayerId);
            } else {
                selectedPrayers.splice(index, 1);
            }
            
            const prayerElements = document.querySelectorAll('.prayer-option');
            prayers.forEach((prayer, idx) => {
                if (prayer.id === prayerId) {
                    const optionIndex = idx + 1;
                    if (optionIndex < prayerElements.length) {
                        prayerElements[optionIndex].classList.toggle('selected', selectedPrayers.includes(prayerId));
                    }
                }
            });
            
            const allOption = document.querySelector('.prayer-option.all-selected');
            if (allOption) {
                allOption.classList.toggle('selected', selectedPrayers.length === prayers.length);
            }
            
            document.getElementById('step3NextBtn').disabled = selectedPrayers.length === 0;
            saveAllData();
        }

        // حساب النتائج
        function calculateResults() {
            const totalDays = calculationDetails.days || 0;
            const prayersPerDay = 5;
            const totalPrayers = totalDays * prayersPerDay;
            const prayersCount = selectedPrayers.length || 1;
            const prayersPerType = Math.ceil(totalPrayers / prayersCount);
            
            calculationResults = {
                totalDays: totalDays,
                totalPrayers: totalDays * selectedPrayers.length,
                prayersPerType: totalDays,
                selectedPrayers: [...selectedPrayers],
                calculationMethod: calculationMethod,
                calculationDetails: {...calculationDetails}
            };
            saveAllData();
        }

        // إعداد الخطوة 4 (عرض النتائج)
        function setupStep4() {
            const step4Content = document.getElementById('step4Content');
            let methodText = '';
            switch(calculationMethod) {
                case 'days':
                    methodText = `${calculationDetails.days} يوم`;
                    break;
                case 'months':
                    methodText = `${calculationDetails.months} شهر (تقريباً ${calculationDetails.days} يوم)`;
                    break;
                case 'years':
                    methodText = `${calculationDetails.years} سنة (تقريباً ${calculationDetails.days} يوم)`;
                    break;
                case 'range':
                    methodText = `من ${formatDate(calculationDetails.startDate)} إلى ${formatDate(calculationDetails.endDate)} (${calculationDetails.days} يوم)`;
                    break;
            }
            
            const selectedPrayersNames = selectedPrayers.map(pId => 
                prayers.find(p => p.id === pId).name
            ).join('، ');
            
            step4Content.innerHTML = `
                <div class="results-summary">
                    <h3>ملخص الحساب</h3>
                    <p>طريقة الحساب: ${methodText}</p>
                    <p>الصلوات المختارة: ${selectedPrayersNames}</p>
                    <div class="total-prayers-needed">${calculationResults.totalPrayers} صلاة</div>
                    <p>إجمالي عدد الصلوات المطلوبة</p>
                </div>
                
                <div class="result-details">
                    ${selectedPrayers.map(pId => {
                        const prayer = prayers.find(p => p.id === pId);
                        return `
                            <div class="result-item">
                                <div class="result-prayer">${prayer.name}</div>
                                <div class="result-count">${calculationResults.prayersPerType}</div>
                                <div>صلاة</div>
                            </div>
                        `;
                    }).join('')}
                </div>
                
                <p style="text-align: center; margin-top: 20px; color: #666; font-size: 1.1rem;">
                    هذه الأعداد بناءً على المدة التي أدخلتها
                </p>
            `;
        }

        // تطبيق نتائج الحساب على التطبيق
        function applyCalculationResults() {
            prayers.forEach(prayer => {
                if (selectedPrayers.includes(prayer.id)) {
                    prayer.target = calculationResults.prayersPerType;
                }
            });
            
            userSelectedPrayers = [...selectedPrayers];
            calculationCompleted = true;
            
            saveAllData();
            showMainSections();
            showAlert('تم الحساب', 'تم حساب وحفظ الصلوات المطلوبة بنجاح', 'success');
            
            // إعادة تشغيل نظام الإشعارات
            startNotificationSystem();
        }

        // تحديث الأهداف
        function updateTargets(e) {
            e.preventDefault();
            let hasError = false;
            
            prayers.forEach(prayer => {
                const input = document.getElementById(`${prayer.id}Target`);
                if (input) {
                    const value = parseInt(input.value);
                    if (isNaN(value) || value < 0) {
                        showAlert('خطأ في الإدخال', `عدد صلاة ${prayer.name} يجب أن يكون رقماً موجباً`, 'warning');
                        hasError = true;
                        input.focus();
                        return;
                    }
                    prayer.target = value || 0;
                    if (prayer.count > prayer.target) {
                        prayer.count = prayer.target;
                    }
                }
            });
            if (!hasError) {
                saveAllData();
                if (currentPage === 'main') {
                    renderPrayerCards();
                    updateStats();
                }
                showAlert('تم التحديث', 'تم تحديث أعداد الصلوات المطلوبة بنجاح', 'success');
            }
        }

        function renderPrayerCards() {
            const container = document.getElementById('prayersSection');
            container.innerHTML = '';
            
            const prayersToShow = userSelectedPrayers.length > 0 ? 
                prayers.filter(prayer => userSelectedPrayers.includes(prayer.id)) : 
                prayers;
            
            prayersToShow.forEach(prayer => {
                const lastRecord = prayer.records.length > 0 ? prayer.records[prayer.records.length - 1] : null;
                const lastRecordText = lastRecord ? 
                    `آخر قضاء: ${formatDate(lastRecord.date)} الساعة ${lastRecord.time}` : 
                    'لم تقم بقضاء هذه الصلاة بعد';
                
                const progressPercent = prayer.target > 0 ? Math.min((prayer.count / prayer.target) * 100, 100) : 0;
                const isDisabled = prayer.target > 0 && prayer.count >= prayer.target;
                
                const card = document.createElement('div');
                card.className = 'prayer-card';
                card.innerHTML = `
                    <div class="prayer-name">${prayer.name}</div>
                    <div class="prayer-icon"><i class="${prayer.icon}"></i></div>
                    <div class="prayer-count">${prayer.count} / ${prayer.target}</div>
                    <div class="prayer-target">صلاة</div>
                    <div class="prayer-progress-container">
                        <div class="prayer-progress-bar" style="width: ${progressPercent}%"></div>
                    </div>
                    <div class="prayer-date">${lastRecordText}</div>
                    <button class="btn" onclick="addPrayer('${prayer.id}')" ${isDisabled ? 'disabled' : ''}>
                        <i class="fas fa-check-circle"></i> ${isDisabled ? 'تم إكمال المطلوب' : 'سجل صلاة قضاء'}
                    </button>
                `;
                container.appendChild(card);
            });
            container.style.display = 'grid';
        }

        function addPrayer(prayerId) {
            const prayer = prayers.find(p => p.id === prayerId);
            if (!prayer) return;
            
            if (prayer.target > 0 && prayer.count >= prayer.target) {
                showAlert('تم الإكمال', `لقد أكملت قضاء ${prayer.name} المطلوبة`, 'info');
                return;
            }
            
            const now = new Date();
            const date = now.toISOString().split('T')[0];
            const time = now.toTimeString().split(' ')[0].substring(0, 5);
            prayer.count++;
            prayer.records.unshift({ date, time });
            
            saveAllData();
            if (currentPage === 'main') {
                renderPrayerCards();
                updateStats();
            }
            if (currentPage === 'records') {
                renderRecords();
            }
            
            resetNotificationForPrayer(prayerId);
            
            if (prayer.target > 0 && prayer.count >= prayer.target) {
                showAlert('مبروك!', `لقد أكملت قضاء ${prayer.name} المطلوبة`, 'success');
            } else {
                showAlert('تم التسجيل بنجاح', `تم تسجيل قضاء ${prayer.name} بنجاح`, 'success');
            }
        }

        function updateStats() {
            const statsSection = document.getElementById('statsSection');
            
            const prayersToCalculate = userSelectedPrayers.length > 0 ? 
                prayers.filter(prayer => userSelectedPrayers.includes(prayer.id)) : 
                prayers;
            
            const totalCount = prayersToCalculate.reduce((sum, prayer) => sum + prayer.count, 0);
            const totalTarget = prayersToCalculate.reduce((sum, prayer) => sum + prayer.target, 0);
            const remaining = totalTarget - totalCount;
            
            statsSection.innerHTML = `
                <div class="stats-card">
                    <h2><i class="fas fa-calendar-check"></i> إجمالي صلوات القضاء</h2>
                    <div class="total-prayers" id="totalPrayers">${totalCount}</div>
                    <p>عدد الصلوات التي قضيتها</p>
                </div>
                <div class="stats-card">
                    <h2><i class="fas fa-clock"></i> الصلوات المتبقية</h2>
                    <div class="remaining-prayers" id="remainingPrayers">${Math.max(remaining, 0)}</div>
                    <p>عدد الصلوات التي لم تقضها بعد</p>
                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar" style="width: ${totalTarget > 0 ? Math.min((totalCount / totalTarget) * 100, 100) : 0}%"></div>
                    </div>
                </div>
            `;
            statsSection.style.display = 'grid';
        }

        function setupControls() {
            const controlsSection = document.getElementById('controlsSection');
            controlsSection.innerHTML = `
                <button class="control-btn" id="resetAllBtn" onclick="resetAllPrayers()">
                    <i class="fas fa-redo"></i> إعادة تعيين جميع الصلوات
                </button>
                <button class="control-btn" id="resetTargetsBtn" onclick="resetTargets()">
                    <i class="fas fa-bullseye"></i> إعادة تعيين الأهداف
                </button>
                <button class="control-btn" id="backToCalculatorBtn" onclick="backToCalculator()">
                    <i class="fas fa-calculator"></i> إعادة الحساب
                </button>
            `;
            controlsSection.style.display = 'flex';
        }

        function backToCalculator() {
            currentStep = 1;
            calculationMethod = null;
            calculationDetails = {};
            selectedPrayers = [];
            calculationResults = {};
            calculationCompleted = false;
            
            updateProgressBar(1);
            document.querySelectorAll('.calculator-step').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById('step1').classList.add('active');
            document.querySelectorAll('.option-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.getElementById('step1NextBtn').disabled = true;
            document.getElementById('step2NextBtn').disabled = true;
            setupPrayerSelection();
            showMainPage();
            saveAllData();
        }

        function setupFilterDates() {
            const today = new Date();
            const lastMonth = new Date();
            lastMonth.setMonth(today.getMonth() - 1);
            const formatDateForInput = (date) => {
                return date.toISOString().split('T')[0];
            };
            const filterFromDate = document.getElementById('filterFromDate');
            const filterToDate = document.getElementById('filterToDate');
            if (filterFromDate) { 
                filterFromDate.value = formatDateForInput(lastMonth); 
            }
            if (filterToDate) { 
                filterToDate.value = formatDateForInput(today); 
            }
        }

        function applyRecordsFilter() {
            renderRecords();
            showAlert('تم التصفية', 'تم تطبيق عوامل التصفية على السجلات', 'info');
        }

        function clearRecordsFilter() {
            document.getElementById('filterPrayer').value = 'all';
            document.getElementById('filterFromDate').value = '';
            document.getElementById('filterToDate').value = '';
            setupFilterDates();
            renderRecords();
            showAlert('تم المسح', 'تم مسح جميع عوامل التصفية', 'info');
        }

        function renderRecords() {
            const container = document.getElementById('recordsList');
            if (!container) return;
            
            const prayerFilter = document.getElementById('filterPrayer');
            const fromDate = document.getElementById('filterFromDate');
            const toDate = document.getElementById('filterToDate');
            
            const prayerFilterValue = prayerFilter ? prayerFilter.value : 'all';
            const fromDateValue = fromDate ? fromDate.value : null;
            const toDateValue = toDate ? toDate.value : null;
            
            let allRecords = [];
            prayers.forEach(prayer => {
                if (prayerFilterValue !== 'all' && prayer.id !== prayerFilterValue) { 
                    return; 
                }
                prayer.records.forEach(record => {
                    const recordDate = new Date(record.date);
                    let includeRecord = true;
                    if (fromDateValue) {
                        const from = new Date(fromDateValue);
                        if (recordDate < from) { 
                            includeRecord = false; 
                        }
                    }
                    if (toDateValue) {
                        const to = new Date(toDateValue);
                        to.setDate(to.getDate() + 1);
                        if (recordDate >= to) { 
                            includeRecord = false; 
                        }
                    }
                    if (includeRecord) {
                        allRecords.push({
                            prayerName: prayer.name,
                            prayerId: prayer.id,
                            date: record.date,
                            time: record.time,
                            timestamp: new Date(`${record.date}T${record.time}`).getTime()
                        });
                    }
                });
            });
            allRecords.sort((a, b) => b.timestamp - a.timestamp);
            
            if (allRecords.length === 0) {
                let message = 'لا توجد سجلات حتى الآن. ابدأ بقضاء الصلوات!';
                if (prayerFilterValue !== 'all' || fromDateValue || toDateValue) {
                    message = 'لا توجد سجلات تطابق عوامل التصفية المحددة.';
                }
                container.innerHTML = `
                    <div class="no-records">
                        <i class="fas fa-inbox" style="font-size: 3rem; color: #ddd; margin-bottom: 15px;"></i>
                        <p style="font-size: 1.2rem; color: #666;">${message}</p>
                    </div>
                `;
                return;
            }
            
            let recordsHTML = `
                <div class="record-item" style="background-color: #f8f9fa; font-weight: bold; justify-content: center; font-size: 1.1rem;">
                    <i class="fas fa-list-check"></i> عرض ${allRecords.length} سجلاً
                </div>
            `;
            allRecords.forEach(record => {
                const prayer = prayers.find(p => p.id === record.prayerId);
                recordsHTML += `
                    <div class="record-item" style="border-left: 4px solid ${prayer.color};">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="${prayer.icon}" style="color: ${prayer.color};"></i>
                            <div>
                                <div class="record-prayer">${record.prayerName}</div>
                                <div class="record-date">${formatDate(record.date)} - ${record.time}</div>
                            </div>
                        </div>
                        <div style="color: #666; font-size: 0.9rem;">
                            ${formatTimeAgo(new Date(`${record.date}T${record.time}`))}
                        </div>
                    </div>
                `;
            });
            container.innerHTML = recordsHTML;
        }

        function resetAllPrayers() {
            if (confirm('هل أنت متأكد من إعادة تعيين جميع الصلوات؟ سيتم حذف جميع البيانات.')) {
                prayers.forEach(prayer => {
                    prayer.count = 0;
                    prayer.records = [];
                });
                saveAllData();
                if (currentPage === 'main') {
                    updateAllSections();
                }
                if (currentPage === 'records') {
                    renderRecords();
                }
                showAlert('تم التعيين', 'تم إعادة تعيين جميع الصلوات بنجاح', 'success');
            }
        }

        function resetTargets() {
            if (confirm('هل تريد إعادة تعيين جميع الأهداف (الصلوات المطلوبة)؟')) {
                prayers.forEach(prayer => {
                    prayer.target = 0;
                });
                saveAllData();
                if (currentPage === 'main') {
                    updateAllSections();
                }
                if (currentPage === 'target') {
                    renderTargetPage();
                }
                showAlert('تم التعيين', 'تم إعادة تعيين جميع الأهداف بنجاح', 'success');
            }
        }

        function clearAllRecords() {
            if (confirm('هل تريد حذف جميع سجلات التواريخ مع الاحتفاظ بعدد الصلوات؟')) {
                prayers.forEach(prayer => {
                    prayer.records = [];
                });
                saveAllData();
                if (currentPage === 'records') {
                    renderRecords();
                }
                showAlert('تم الحذف', 'تم حذف جميع السجلات بنجاح', 'success');
            }
        }

        // دالة جديدة لتصدير السجلات
        function exportRecords() {
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "الصلاة,التاريخ,الوقت\n";
            
            prayers.forEach(prayer => {
                prayer.records.forEach(record => {
                    csvContent += `${prayer.name},${record.date},${record.time}\n`;
                });
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "سجلات_صلاة_القضاء.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showAlert('تم التصدير', 'تم تصدير السجلات بنجاح', 'success');
        }

        // دالة جديدة لتنسيق الوقت المنقضي
        function formatTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffSec = Math.floor(diffMs / 1000);
            const diffMin = Math.floor(diffSec / 60);
            const diffHour = Math.floor(diffMin / 60);
            const diffDay = Math.floor(diffHour / 24);
            
            if (diffDay > 0) {
                return `منذ ${diffDay} يوم`;
            } else if (diffHour > 0) {
                return `منذ ${diffHour} ساعة`;
            } else if (diffMin > 0) {
                return `منذ ${diffMin} دقيقة`;
            } else {
                return 'الآن';
            }
        }

        function showAlert(title, text, type) {
            const alert = document.getElementById('alertMessage');
            document.getElementById('alertTitle').textContent = title;
            document.getElementById('alertText').textContent = text;
            alert.className = `alert ${type}`;
            alert.classList.add('show');
            setTimeout(() => {
                alert.classList.remove('show');
            }, 3000);
        }

        function formatDate(dateString) {
            if (!dateString) return 'غير محدد';
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-EG', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // نظام الإشعارات للصلوات
        function startNotificationSystem() {
            // إلغاء أي مواعيد سابقة
            clearAllPrayerTimers();
            
            // إذا لم يكن هناك حساب مكتمل، لا تبدأ الإشعارات
            if (!calculationCompleted || userSelectedPrayers.length === 0) {
                return;
            }
            
            // جدولة الإشعارات للصلوات المختارة
            userSelectedPrayers.forEach(prayerId => {
                schedulePrayerNotification(prayerId);
            });
        }

        function clearAllPrayerTimers() {
            // إلغاء جميع المؤقتات
            for (const prayerId in prayerTimers) {
                if (prayerTimers[prayerId]) {
                    clearTimeout(prayerTimers[prayerId]);
                }
            }
            prayerTimers = {};
        }

        function schedulePrayerNotification(prayerId) {
            const prayer = prayers.find(p => p.id === prayerId);
            if (!prayer) return;
            
            // إذا كان المستخدم قد أكمل قضاء هذه الصلاة، لا ترسل إشعارات
            if (prayer.target > 0 && prayer.count >= prayer.target) {
                return;
            }
            
            // الحصول على وقت الإشعار لهذه الصلاة
            const notificationTime = notificationTimes[prayerId];
            if (!notificationTime) return;
            
            // حساب الوقت حتى الإشعار التالي
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            
            // إنشاء وقت الإشعار
            const notificationDate = new Date();
            notificationDate.setHours(notificationTime.hour, notificationTime.minute, 0, 0);
            
            // إذا كان الوقت الحالي بعد وقت الإشعار لليوم، جدوله لليوم التالي
            if (now > notificationDate) {
                notificationDate.setDate(notificationDate.getDate() + 1);
            }
            
            // حساب الوقت حتى الإشعار بالملي ثانية
            const timeUntilNotification = notificationDate.getTime() - now.getTime();
            
            // جدولة الإشعار
            prayerTimers[prayerId] = setTimeout(() => {
                checkAndShowNotification(prayerId, today);
                // جدولة الإشعار التالي لليوم التالي
                schedulePrayerNotification(prayerId);
            }, timeUntilNotification);
            
            console.log(`تم جدولة إشعار لصلاة ${prayer.name} في ${notificationDate.toLocaleTimeString('ar-SA')}`);
        }

        function checkAndShowNotification(prayerId, date) {
            const prayer = prayers.find(p => p.id === prayerId);
            if (!prayer) return;
            
            // التحقق مما إذا كان المستخدم قد صلى هذه الصلاة اليوم
            const prayedToday = prayer.records.some(record => record.date === date);
            
            // التحقق مما إذا كانت الصلاة مطلوبة (لم تكتمل بعد)
            const isRequired = prayer.target === 0 || prayer.count < prayer.target;
            
            // إذا لم يصلها اليوم وهي مطلوبة، أظهر الإشعار
            if (!prayedToday && isRequired) {
                showPrayerNotification(prayer);
            }
        }

        function showPrayerNotification(prayer) {
            // إذا كان المتصفح يدعم إشعارات سطح المكتب
            if ("Notification" in window && Notification.permission === "granted") {
                new Notification(`تذكير بقضاء ${prayer.name}`, {
                    body: `لم تقم بقضاء ${prayer.name} اليوم. هل تريد تسجيلها الآن؟`,
                    icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIzMCIgY3k9IjMwIiByPSIyNSIgZmlsbD0iIzFhNWYyMyIvPjxwYXRoIGQ9Ik0yNSAzNWw1IDUgMTAtMTAiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iNCIgZmlsbD0ibm9uZSIvPjwvc3ZnPg==' 
                }).onclick = function() {
                    window.focus();
                    addPrayer(prayer.id);
                };
            }
            
            // عرض الإشعار في الصفحة أيضا
            const notificationsContainer = document.getElementById('prayerNotifications');
            const notification = document.createElement('div');
            notification.className = 'prayer-notification';
            notification.innerHTML = `
                <h4><i class="fas fa-bell"></i> تذكير بقضاء الصلاة</h4>
                <p>لم تقم بقضاء ${prayer.name} اليوم. هل تريد تسجيلها الآن؟</p>
                <div class="notification-buttons">
                    <button class="notification-btn add-prayer" onclick="addPrayerNotification('${prayer.id}', this)">
                        <i class="fas fa-check-circle"></i> نعم، سجل الصلاة
                    </button>
                    <button class="notification-btn snooze" onclick="snoozeNotification(this)">
                        <i class="fas fa-clock"></i> أذكرني لاحقاً
                    </button>
                </div>
            `;
            notificationsContainer.appendChild(notification);
            
            // طلب إذن الإشعارات إذا لم يكن ممنوعاً بعد
            if ("Notification" in window && Notification.permission === "default") {
                Notification.requestPermission();
            }
        }

        function addPrayerNotification(prayerId, button) {
            const notificationDiv = button.closest('.prayer-notification');
            addPrayer(prayerId);
            if (notificationDiv) {
                notificationDiv.remove();
            }
        }

        function snoozeNotification(button) {
            const notificationDiv = button.closest('.prayer-notification');
            if (notificationDiv) {
                notificationDiv.remove();
                // إعادة جدولة الإشعار بعد 30 دقيقة
                setTimeout(() => {
                    const prayerId = button.closest('.prayer-notification').querySelector('.add-prayer').onclick.toString().match(/'([^']+)'/)[1];
                    const prayer = prayers.find(p => p.id === prayerId);
                    if (prayer) {
                        showPrayerNotification(prayer);
                    }
                }, 30 * 60 * 1000); // 30 دقيقة
            }
        }

        function resetNotificationForPrayer(prayerId) {
            // عند تسجيل صلاة، أزل الإشعار الخاص بها
            const notifications = document.querySelectorAll('.prayer-notification');
            notifications.forEach(notification => {
                if (notification.textContent.includes(prayers.find(p => p.id === prayerId).name)) {
                    notification.remove();
                }
            });
        }

        // نظام تغيير المود (الوضع الداكن/الفاتح)
        function loadTheme() {
            const savedTheme = localStorage.getItem('appTheme');
            if (savedTheme === 'dark') {
                darkMode = true;
                document.body.classList.add('dark-mode');
                document.getElementById('themeSwitch').checked = true;
            } else {
                darkMode = false;
                document.body.classList.remove('dark-mode');
                document.getElementById('themeSwitch').checked = false;
            }
        }

        function saveTheme() {
            localStorage.setItem('appTheme', darkMode ? 'dark' : 'light');
        }

        function toggleTheme() {
            darkMode = !darkMode;
            if (darkMode) {
                document.body.classList.add('dark-mode');
                document.getElementById('themeSwitch').checked = true;
            } else {
                document.body.classList.remove('dark-mode');
                document.getElementById('themeSwitch').checked = false;
            }
            saveTheme();
            showAlert('تم التغيير', `تم تغيير المود إلى ${darkMode ? 'الوضع الداكن' : 'الوضع الفاتح'}`, 'success');
        }

        // تبديل المود عن طريق زر السويتش
        function toggleThemeBySwitch() {
            // استدعاء دالة تبديل المود
            toggleTheme();
        }
        
        // دالة مساعدة للتحقق من إشعارات الصلاة
        function checkPrayerNotifications() {
            // هذا سيتم استدعاؤه عند تحديث الصفحة الرئيسية
            // يمكن إضافة منطق للتحقق من الصلوات المطلوبة اليوم
        }
    </script>
</body>
</html>
